/**
 * Project Name:XuYuRepos
 * File Name:SynInfoFacadeService.java
 * Package Name:com.xuyurepos.service.intergration.facade
 * Date:2019年3月29日下午4:21:31
 * Copyright (c) 2019, chenzhou1025@126.com All Rights Reserved.
 *
*/

package com.xuyurepos.service.intergration.facade;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.HashMap;
import java.util.Map;

import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.xuyurepos.common.util.JsonUtil;
import com.xuyurepos.service.intergration.cmp.MobileCMPRequest;

/**
 * ClassName:SynInfoFacadeService <br/>
 * Function: TODO ADD FUNCTION. <br/>
 * Reason:	 TODO ADD REASON. <br/>
 * Date:     2019年3月29日 下午4:21:31 <br/>
 * @author   zhangliang
 * @version  
 * @since    JDK 1.8
 * @see 	 
 */
public class SynInfoJSFacadeService {

	static Logger logger=LoggerFactory.getLogger(SynInfoJSFacadeService.class);
	
    private SynInfoJSFacadeService() {
        if (SynInfoJSFacadeInnerService.instance != null) {
            throw new IllegalStateException();
        }
    }
    
    private static class SynInfoJSFacadeInnerService {
    	private static SynInfoJSFacadeService instance = new SynInfoJSFacadeService();
    }

    public static SynInfoJSFacadeService getInstance() {
        return SynInfoJSFacadeInnerService.instance;
    }
	
	
	
	/*******************************************移动接口调用开始***********************************************/
	/**
	 * 
	 * downTimeByMobile:(移动物联网卡停复机). <br/>
	 * TODO(这里描述这个方法适用条件 – 可选).<br/>
	 * TODO(这里描述这个方法的执行流程 – 可选).<br/>
	 * TODO(这里描述这个方法的使用方法 – 可选).<br/>
	 * TODO(这里描述这个方法的注意事项 – 可选).<br/>
	 *
	 * @author zhangliang
	 * @param msisdn
	 * @param operType  0-暂停 1-恢复

	 * @return
	 * @since JDK 1.8
	 */
	
	public boolean  mobileChangeCardState(String msisdn, String operType) {
		try {
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();

		}
		return false;
	}
	
	/**
	 * 
	 * cardStatusService:(同卡用量). <br/>
	 * TODO(这里描述这个方法适用条件 – 可选).<br/>
	 * TODO(这里描述这个方法的执行流程 – 可选).<br/>
	 * TODO(这里描述这个方法的使用方法 – 可选).<br/>
	 * TODO(这里描述这个方法的注意事项 – 可选).<br/>
	 *  卡状态：0 未激活 1 正常 2 停机 3 测试期 4 沉默期 5 其他
	 * @author zhangliang
	 * @param msisdn
	 * @since JDK 1.8
	 */
	public String mobileGPRSQueryService(String msisdn,String ownerPlace) {

		try {
			Map map = new HashMap();
			map.put("msisdn", msisdn);
			String result = MobileCMPRequest.wholeMobileCMPRequest("0001000000012", msisdn, "gprsusedinfosingle", ownerPlace);
			logger.info(result);
			Map resultMap = JsonUtil.parseJson2Map(result);

			
			JSONArray jsonArray=(JSONArray) JSONArray.parseArray(resultMap.get("result")+"");
			
			JSONObject jsonObject=(JSONObject) jsonArray.get(0);
			
			if(null==jsonObject) {
				return "";
			}
			
			String totalGPRS= jsonObject.get("total_gprs").toString();
			
			String used=new BigDecimal(totalGPRS).divide(new BigDecimal(1024)).setScale(0,RoundingMode.HALF_UP).toPlainString();
		return used;
		} catch (Exception e) {
			e.printStackTrace();
			
		}
		return "";
	}
	
	/**
	 * 
	 * messageSendService:(提供发送本地号码API。). <br/>
	 * TODO(这里描述这个方法适用条件 – 可选).<br/>
	 * TODO(这里描述这个方法的执行流程 – 可选).<br/>
	 * TODO(这里描述这个方法的使用方法 – 可选).<br/>
	 * TODO(这里描述这个方法的注意事项 – 可选).<br/>
	 *
	 * @author zhangliang
	 * @param msisdn
	 * @param content
	 * @return
	 * @since JDK 1.8
	 */
	
	public boolean mobileMessageSendService(String msisdn,String content,String ownerPlace) {


		try {

			return true;
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
	
	
	}
	
	/**
	 * 
	 * userStatusQuery:(卡工作状态). <br/>
	 * TODO(这里描述这个方法适用条件 – 可选).<br/>
	 * TODO(这里描述这个方法的执行流程 – 可选).<br/>
	 * TODO(这里描述这个方法的使用方法 – 可选).<br/>
	 * TODO(这里描述这个方法的注意事项 – 可选).<br/>
	 *  00-正常；
 01-单向停机；
 02-停机；
 03-预销号；
 04-销号；
 05-过户；
 06-休眠；
 07-待激活；
 99-号码不存在

	 * @author zhangliang
	 * @param msisdn
	 * @return
	 * @since JDK 1.8
	 */
	public String mobileUserStatusQuery(String msisdn,String ownerPlace) {



		try {
			Map map = new HashMap();
			map.put("msisdn",msisdn);
			String result = MobileCMPRequest.wholeMobileCMPRequest("0001000000009", msisdn, "userstatusrealsingle", ownerPlace);
			logger.info(result);
			Map resultMap = JsonUtil.parseJson2Map(result);

			String code = resultMap.get("code") + "";
			if (code.equals("00000")) {
				Map body = JsonUtil.parseJson2Map(resultMap.get("body") + "");
				String status = body.get("status") + "";
				if(StringUtils.isNotBlank(status)&&!"null".equals(status)) {

		          return status;
				}else {
					return "";
				}
			}
			return "";
		} catch (Exception e) {
			e.printStackTrace();
			return "";
		}
	
	
	
	}
/********************************************************移动接口调用结束**********************************************/	
	
	

}

