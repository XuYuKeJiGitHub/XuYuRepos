
<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css" />-->
		<style>
			.mui-card .mui-control-content {
				padding: 10px;
			}
			
			.mui-control-content {
				height: 150px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">在线充值</h1>
		</header>
		<div class="mui-content">
			<div style="padding: 10px 10px;">
				<div id="segmentedControl" class="mui-segmented-control">
					<a class="mui-control-item mui-active" href="#item1">公告</a>
					<a class="mui-control-item" href="#item2">在线充值</a>
					<a class="mui-control-item" href="#item3">流量查询</a>
					<a class="mui-control-item" href="#item4">实名认证</a>
				</div>
			</div>
			<div>
				<div id="item1" class="mui-control-content mui-active">
					<div id="scroll" class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">
							</ul>
						</div>
					</div>
				</div>
				<div id="item2" class="mui-control-content">
					<ul class="mui-table-view">
						<p>
					       <a href="#picture" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined" style="padding: 5px 20px;">打开支付</a>
				        </p>
				        
				        <div class="mui-input-row">
							<label>流量卡号</label>
							<input type="text" class="mui-input-clear" placeholder="请输入流量卡号/手机号">
					    </div>
				        
				        <div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell ">
								    <a href="#"  >支付宝</a>
								</li>
								<li class="mui-table-view-cell">
									<a href="#" onclick="callpay()">微信支付</a>
								</li>
							</ul>
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<a href="#picture"><b>取消支付</b></a>
								</li>
							</ul>
						</div>
					</ul>
				</div>
				<div id="item3" class="mui-control-content">
					<ul class="mui-table-view">
						
					</ul>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script>
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			(function($) {
				$('#scroll').scroll({
					indicators: true //是否显示滚动条
				});
				var segmentedControl = document.getElementById('segmentedControl');
				$('.mui-input-group').on('change', 'input', function() {
					if (this.checked) {
						var styleEl = document.querySelector('input[name="style"]:checked');
						var colorEl = document.querySelector('input[name="color"]:checked');
						if (styleEl && colorEl) {
							var style = styleEl.value;
							var color = colorEl.value;
							segmentedControl.className = 'mui-segmented-control' + (style ? (' mui-segmented-control-' + style) : '') + ' mui-segmented-control-' + color;
						}
					}
				});
				
				function jsApiCall() {
		            WeixinJSBridge.invoke(
		            'getBrandWCPayRequest', {
		                "appId": '@ViewBag.appId',     //公众号名称，由商户传入
		                "timeStamp": '@ViewBag.timeStamp',         //时间戳，自1970年以来的秒数
		                "nonceStr": '@ViewBag.nonceStr', //随机串
		                "package": '@ViewBag.package',
		                "signType": "MD5",         //微信签名方式：
		                "paySign": '@ViewBag.paySign' //微信签名
		            },
		            function (res) {
		                if (res.err_msg == "get_brand_wcpay_request：ok") {

		                    $.ajax({
		                        contentType: "application/json",
		                        url: "/OnlinePay/WxPay_return_url",
		                        data: "{orderid:'" + $("#orderid").val() + "'}",
		                        type: "POST",
		                        dataType: "json",
		                        success: function (json) {
		                            if (json.success == "success") {
		                                window.location = "/Member/ShopPayOk?orderid=" + $("#orderid").val() + "&money=" + json.money;
		                            }
		                            else {
		                                //alert(json.msg);
		                                //webToast("json.msg=" + json.msg, "middle", 3000);
		                                if ($("#orderid").val().toUpperCase().indexOf("D") != -1)
		                                    window.location = "/Member/Order";
		                                else if ($("#orderid").val().toUpperCase().indexOf("R") != -1)
		                                    window.location = "/Member/AcctionLl";
		                            }
		                        },
		                        error: function (err, ex) {
		                            //alert(err.responseText);
		                            //webToast("err.responseText=" + err.responseText, "middle", 3000);
		                            if ($("#orderid").val().toUpperCase().indexOf("D") != -1)
		                                window.location = "/Member/Order";
		                            else if ($("#orderid").val().toUpperCase().indexOf("R") != -1)
		                                window.location = "/Member/AcctionLl";
		                        }
		                    });
		                }     // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
		                else {
		                    //webToast(res.err_code + "<br/>" + res.err_desc + "<br/>" + res.err_msg, "middle", 3000);
		                    //webToast("呵呵呵", "middle", 3000);
		                    if ($("#orderid").val().toUpperCase().indexOf("D") != -1)
		                        window.location = "/Member/Order";
		                    else if ($("#orderid").val().toUpperCase().indexOf("R") != -1)
		                        window.location = "/Member/AcctionLl";
		                }
		            }
		            );
		        }

		        function callpay() {
		            if (typeof WeixinJSBridge == "undefined") {
		                if (document.addEventListener) {
		                    document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
		                }
		                else if (document.attachEvent) {
		                    document.attachEvent('WeixinJSBridgeReady', jsApiCall);
		                    document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
		                }
		            }
		            else {
		                jsApiCall();
		            }
		        }

		       
			})(mui);
		</script>

	<script>document.write('<script src="//' + (location.host || 'localhost').split(':')[0] + ':35929/livereload.js?snipver=1"></' + 'script>')</script><script>document.addEventListener('LiveReloadDisconnect', function() { setTimeout(function() { window.location.reload(); }, 500); })</script></body>

</html>