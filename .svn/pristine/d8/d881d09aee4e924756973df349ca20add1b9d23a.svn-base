<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>在线充值系统</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet"  href="layui/css/layui.css"  media="all">
  <link rel="stylesheet"  href="css.css"  media="all">
  <link rel="stylesheet"  href="index.css"  media="all">
  <script src="layui/layui.all.js" charset="utf-8"></script>
</head>
 <legend  class="alignCenter" style="background: red;color:white;font-size: 18px;border-buttom:1px solid #000;">流量在线充值系统</legend>
 
<div class="layui-tab" style="margin-top:0px;border: 0px;">
  <ul class="layui-tab-title alignCenter" style="background: red;color:white;font-size: 18px;">
    <li>公告</li>
    <li class="layui-this">在线充值</li>
    <li>流量查询</li>
    <li>实名认证</li>
  </ul>
  <div class="layui-tab-content">
    <div class="layui-tab-item">
    </div>
    
    
    <div class="layui-tab-item layui-show">
    
    <div class="m20 recharge">
		<div class="item item-input item-select waves-effect">
			<div class="input-label">选择套餐类型</div>
			<select class="ng-pristine ng-untouched ng-valid ng-not-empty">
				<option value=" number:8"></option>
				<optgroup label="移动卡流量包">
					<option class="ng-binding">移动 - 全部</option>
					<option class="ng-binding">移动 - 月清零</option>
					<option class="ng-binding">移动 - 半年清零</option>
					<option class="ng-binding">移动 - 1年清零</option>
				</optgroup>
				
				<optgroup label="电信卡流量包">
					<option value="7" class="ng-binding">电信 - 全部</option>
					<option class="ng-binding">电信 - 月清零</option>
					<option class="ng-binding">电信 - 半年清零</option>
					<option class="ng-binding">电信 - 1年清零</option>
				</optgroup>
				
				<optgroup label="联通卡流量包">
					<option class="ng-binding">联通 - 全部</option>
					<option class="ng-binding">联通 - 月清零</option>
					<option class="ng-binding">联通 - 半年清零</option>
					<option class="ng-binding">联通 - 1年清零</option>
				</optgroup>
			
			</select>
		</div>
		<br>
		<div class="list">
			<label class="item item-input item-stacked-label waves-effect">
				<span class="input-label" aria-label="流量卡号" id="_label-1">流量卡号</span>
				<input id="accessNums"  type="text" ng-model="recharge.Entity.FlowCardNo" placeholder="请输入流量卡号/手机号" class="ng-pristine ng-untouched ng-valid ng-empty">
			</label>
			<div class="packageList">
			
		   </div>
	  </div>
		  </div>
    
    </div>
    
    
    <div class="layui-tab-item">
        <div class="scroll">
	<div class="m20 query">
	<div class="list">
		<label class="item item-input item-stacked-label waves-effect">
			<span class="input-label">流量卡号</span>
			<input type="text" placeholder="请输入流量卡号/手机号" class="ng-pristine ng-untouched ng-valid ng-empty">
		</label>
		<button class="button button-block button-assertive waves-effect">查询</button>
	</div>
	</div>
</div>
</div>
    

    <div class="layui-tab-item">
        
        <div class="list">
	<label class="item item-input item-stacked-label waves-effect">
		<span class="input-label" >流量卡号</span>
		<input type="text" placeholder="请输入卡号码" class="ng-pristine ng-untouched ng-valid ng-empty">
	</label>
	<br>
	<label class="item item-input item-stacked-label waves-effect">
		<span class="input-label">姓名</span>
		<input type="text" placeholder="您的真实姓名" class="ng-pristine ng-valid ng-empty ng-touched" >
	</label>
		<br>
	<label class="item item-input item-stacked-label waves-effect">
		<span class="input-label">手机号码</span>
		<input type="text" placeholder="联系手机号码" ng-model="authen.Entity.Mobile" class="ng-pristine ng-untouched ng-valid ng-empty" style="">
	</label>
		<br>
	<label class="item item-input item-stacked-label waves-effect">
		<span class="input-label">身份证号</span>
		<input type="text" placeholder="您的身份证号" class="ng-pristine ng-untouched ng-valid ng-empty" style="">
	</label>
		<br>
	<div class="item item-input item-stacked-label">
		<a href="javascript:;" class="a-upload ng-binding">
			<input type="file" class="button button-full button-positive" nv-file-select="" uploader="authen.uploader" multiple="">上传身份证正、反面，手持身份证（0/3）</a>
	</div>
	<button class="button button-block button-assertive waves-effect">提交认证资料</button>
	</div>
    </div>
  </div>
</div>

 <div id="add-main" style="padding: 3px; background-color: #F2F2F2;">
		  <div class="layui-card alignCenter" >
	           <div id="alipay" class="layui-card-body" style="color: blue;"><img src="image/alipay.jpg"></img></div>
	           <div id="wxpay" class="layui-card-body" style="color: blue;"><img src="image/wx.png"></img></div>
	           <div id="cancle" class="layui-card-body" style="color: blue;">取消支付</div>
         </div>
  </div> 

<script src="../js/jquery.min-1.12.4.js"></script>
<script type="text/javascript">

(function ($) {
    $.getUrlParam = function (name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    
    $("#add-main").hide();
	
	$(document).on("click","a[class=packageItem]",function(){
		 //页面层-自定义
	    layer.open({
	        type: 1,
	        title:"请选择支付方式",
	        closeBtn: false,
	        shift: 2,
	        area: ['100%', '220px'],
	        offset: 'b',
	        shadeClose: false,
	        content: $("#add-main"),
	        success: function(layero, index){}
	      });
	});
	
	$('#alipay').click(function(){
		// 首先生成订单
		var id=$.getUrlParam("id");
		var accessNums=$("#accessNums").val();
		if(accessNums==''){
			layer.msg('请输入充值账号');
		}else{
			// 检验数字有效性
			 $.ajax({            
		         type:"POST",   //post提交方式默认是get
		         data : {
		        	 accessNums : accessNums
		         },
		         url:'/XuYuRepos/alipay/checkNums',
		         success:function(data){
                	if(data.sucess!=undefined&&data.sucess==false){
                		layer.msg(data.msg);
                	}else{
                		if(data.result==true){
                			// 生成订单
                			$.ajax({            
                		         type:"POST",   //post提交方式默认是get
                		         data : {
                		        	 accessNums : accessNums,
                		        	 money:'10.5'
                		         },
                		         url:'/XuYuRepos/alipay/createOrder',
                		         success:function(data){
                		        	 if(data.sucess!=undefined&&data.sucess==false){
                		        		 layer.msg(data.msg);
                		        	 }else{
                		        		 location.href="../wappay/pay.jsp?cardNo="+data.order.id+"&WIDtotal_amount=0.01";
                		        	 }
                				 },
                				 error:function(rep){
                					 layer.msg('订单生成错误，请稍候再试');
                				 }
                		    });
                		}else{
                			layer.msg('充值账号错误');
                		}
                	}
				 },
				 error:function(rep){
					layer.msg('充值账号错误');
				 }
		      });
		}
	});
	
	$('#wxpay').click(function(){
		alert("微信支付");
		// 首先生成订单
		var id=$.getUrlParam("id");
		var accessNums=$("#accessNums").val();
		if(accessNums==''){
			layer.msg('请输入充值账号');
		}else{
			// 检验数字有效性
			 $.ajax({            
		         type:"POST",   //post提交方式默认是get
		         data : {
		        	 accessNums : accessNums
		         },
		         url:'/XuYuRepos/alipay/checkNums',
		         success:function(data){
                	if(data.sucess!=undefined&&data.sucess==false){
                		layer.msg(data.msg);
                	}else{
                		if(data.result==true){
                			// 生成订单
                			$.ajax({            
                		         type:"POST",   //post提交方式默认是get
                		         data : {
                		        	 accessNums : accessNums,
                		        	 money:'10.5'
                		         },
                		         url:'/XuYuRepos/alipay/createOrder',
                		         success:function(data){
                		        	 if(data.sucess!=undefined&&data.sucess==false){
                		        		 layer.msg(data.msg);
                		        	 }else{
                		        		 // 直接扫码支付
                		        		 $.ajax({            
			                		         type:"POST",   //post提交方式默认是get
			                		         data : {
			                		        	 totalFee : 0.01,
			                		        	 tradeType:'NATIVE',
			                		        	 out_trade_no:data.order.id
			                		         },
			                		         url:'/XuYuRepos/wxpay/pay',
			                		         success:function(data){
			                		        	 
			                		        	 //location.href=data.nonceStr;
			                		         }
                		        	    });
                		        	 }
                				 },
                				 error:function(rep){
                					 layer.msg('订单生成错误，请稍候再试');
                				 }
                		    });
                		}else{
                			layer.msg('充值账号错误');
                		}
                	}
				 },
				 error:function(rep){
					layer.msg('充值账号错误');
				 }
		      });
		}
	});
	
	$('#cancle').click(function(){
		layer.closeAll();
		$("#add-main").hide();
	});
    
	
    var id=$.getUrlParam("id");
    if(id==null){
    	layer.msg('非法参数');
    }else{
	   	 $.ajax({            
	         type:"POST",   //post提交方式默认是get
	         url:'/XuYuRepos/xuyupackages/views',
	         success:function(data){
	        	var dataDiv="";
	        	for (var int = 0; int < data.total; int++) {
					dataDiv=dataDiv+'<a class="packageItem"><font class="ng-binding">￥'+data.rows[int].actualPrice+'</font><h2 class="ng-binding">'+data.rows[int].gprs+'MB/月流量</h2></a>';
				}
	        	$("div[class=packageList]").append(dataDiv);
			 },
			 error:function(rep){
				alert("错误");
			 }
	      });
    }
})(jQuery);

</script>
</html>