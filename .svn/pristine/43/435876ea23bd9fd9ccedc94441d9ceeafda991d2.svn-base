/**
 * Project Name:XuYuRepos
 * File Name:SynInfoBatchService.java
 * Package Name:com.xuyurepos.service.intergration.batch
 * Date:2019年4月2日下午1:24:36
 * Copyright (c) 2019, chenzhou1025@126.com All Rights Reserved.
 *
*/

package com.xuyurepos.service.intergration.batch;

import java.net.InetAddress;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.xuyurepos.dao.batch.CardStateChangeDao;
import com.xuyurepos.entity.manager.XuyuContentCardInfo;
import com.xuyurepos.service.intergration.facade.SynInfoFacadeService;
import com.xuyurepos.service.intergration.facade.SynInfoJSFacadeService;

/**
 * ClassName:SynInfoBatchService <br/>
 * Function: TODO ADD FUNCTION. <br/>
 * Reason: TODO ADD REASON. <br/>
 * Date: 2019年4月2日 下午1:24:36 <br/>
 * 
 * @author zhangliang
 * @version
 * @since JDK 1.8
 * @see
 */
@Service
public class SynInfoBatchService {


	@Autowired
	private CardStateChangeDao cardInfoDao;
	
	public void sync() {
        try {
				String address= InetAddress.getLocalHost().getHostAddress();
//				if(!address.equals("")) {
//					return ;
//				}
		updateCardState(20);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	private List queryData(int limitSize) {
		List<XuyuContentCardInfo>	 cardInfoList=cardInfoDao.queryData(limitSize);
		return cardInfoList;
	}
	private void updateCardState(int limitSize) {
		List<XuyuContentCardInfo>	 cardInfoList =	queryData(limitSize);
		for (XuyuContentCardInfo info : cardInfoList) {
			String id=info.getId();
			if(info.getProvider().equals("1")) {
				String ownerPlace=info.getOwnerPlace();
				String status="";
				String accessNum=info.getAccessNum();
				if(ownerPlace.equals("1")||ownerPlace.equals("2")) {
					status=	SynInfoJSFacadeService.getInstance().mobileUserStatusQuery(accessNum,ownerPlace);
				}else if(ownerPlace.equals("3")) {
					status=	SynInfoFacadeService.getInstance().mobileUserStatusQuery(accessNum);
				}
				cardInfoDao.updateDataState(id, status);
			}else if(info.getProvider().equals("2")) {
				String accid=info.getIccid();
				String status=SynInfoFacadeService.getInstance().unicomUserStatusQuery(accid);
				cardInfoDao.updateDataState(id, status);
			}else if(info.getProvider().equals("3")) {
				String accessNum=info.getAccessNum();
				String status=SynInfoFacadeService.getInstance().telecomUserStatusQuery(accessNum);
				cardInfoDao.updateDataState(id, status); 
			}
		}
		
	}
	
}
