<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuyurepos.dao.autorule.AotoRuleManagerDao">
	<cache></cache>
	 <insert id="saveRule" parameterType="com.xuyurepos.vo.autorule.AutoRuleManagerDTO">
         INSERT INTO XUYU_RULE_INFO (
				RULE_ID,
				RULE_TYPE,
				RULE_VALUE,
				GPRS,
				RULE_DESC,
				RULE_NAME,
				INVALID,
				OWNER,
				OWNER_NAME,
				ACCESS_NUM,
				ACCESS_NUM_START,
				ACCESS_NUM_END,
				DAYS,
				MESSAGE_PHONE,
				MESSAGE_MAIL,
				AFFECT_RANGE,
				START_DATE,
				CREATE_DATE,
				CREATE_USER,
				UPDATE_DATE,
				UPDATE_USER,
				OPRATE_TYPE 
			)
			VALUES(
	          #{ruleId,javaType=String}
	          ,#{ruleType,javaType=String}
	          ,#{rate,javaType=DECIMAL}
	          ,#{gprs,javaType=DECIMAL}
	          ,#{ruleDesc,javaType=String}
	          ,#{ruleName,javaType=String}
	          ,'Y'
	          ,#{ownerId,javaType=String}
	          ,#{ownerName,javaType=String}
	          ,#{accessNums,javaType=String}
	          ,#{accessNumStart,javaType=String}
	          ,#{accessNumEnd,javaType=String}
	          ,#{days,javaType=DECIMAL}
	          ,#{messageId,javaType=String}
	          ,#{emailId,javaType=String}
	          ,#{bindType,javaType=String}
	          ,SYSDATE()
	          ,SYSDATE()
	          ,#{createUser,javaType=String}
	          ,SYSDATE()
	          ,#{createUser,javaType=String}
	          ,#{oprateType,javaType=String}
	          )          
     </insert>
     
     <resultMap type="com.xuyurepos.vo.autorule.AutoRuleManagerDTO" id="autoRule">
		<!-- column存数据库中的属性   property存javabean中数据-->
		<id column="ID" property="id" jdbcType="VARCHAR"/>
		<result column="RULE_ID" property="ruleId" jdbcType="VARCHAR"/>
		<result column="RULE_NAME" property="ruleName" jdbcType="VARCHAR"/>
		<result column="RULE_TYPE" property="ruleType" jdbcType="VARCHAR"/>
		<result column="RULE_VALUE" property="rate" jdbcType="DECIMAL"/>
		<result column="GPRS" property="gprs" jdbcType="DECIMAL"/>
		<result column="DAYS" property="days" jdbcType="DECIMAL"/>
		<result column="OWNER" property="ownerId" jdbcType="VARCHAR"/>
		<result column="ACCESS_NUM" property="accessNums" jdbcType="VARCHAR"/>
		<result column="ACCESS_NUM_START" property="accessNumStart" jdbcType="VARCHAR"/>
		<result column="ACCESS_NUM_END" property="accessNumEnd" jdbcType="VARCHAR"/>
		<result column="AFFECT_RANGE" property="bindType" jdbcType="VARCHAR"/>
		<result column="CREATE_USER" property="createUser" jdbcType="VARCHAR"/>
		<result column="CREATE_DATE" property="createDate" jdbcType="TIMESTAMP"/>
		<result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR"/>
		<result column="UPDATE_DATE" property="updateDate" jdbcType="TIMESTAMP"/>
		<result column="OPRATE_TYPE" property="oprateType" jdbcType="VARCHAR"/>
	</resultMap>
	
    <sql id="sql_count">
        SELECT COUNT(*)
    </sql>
    
    <sql id="sql_select">
        SELECT *
    </sql>
    
    <sql id="sql_where">
        FROM XUYU_RULE_INFO
        <where>
            <if test="queryObj != null">
                <if test="queryObj.ruleName != null and queryObj.ruleName != ''">
                    AND RULE_NAME like 
                    '%${queryObj.ruleName}%'
                </if>
                <if test="queryObj.startDate != null and queryObj.startDate != ''">
                AND (END_DATE  &gt;= str_to_date(${queryObj.startDate},'%Y-%m-%d')
                or END_DATE is null)
                </if>
                <if test="queryObj.endDate != null and queryObj.endDate != ''">
                    AND START_DATE  &lt;= str_to_date(${queryObj.startDate},'%Y-%m-%d')
                </if>
                 <if test="queryObj.isValidate != null and queryObj.isValidate != ''">
                    AND INVALID ='%${queryObj.isValidate}%'
                </if>
                 
            </if>
        </where>
    </sql>
    
   <select id="selectRuleListWithPage" parameterType="com.xuyurepos.common.page.PageModel" resultMap="autoRule">
        <include refid="sql_select"></include>
        <include refid="sql_where"></include>
        <if test="pageNumber != null and  pageSize!= null">
            limit #{startRow},#{pageSize}
        </if>
    </select>

    <select id="selectRuleCountWithPage" parameterType="com.xuyurepos.common.page.PageModel" resultType="Integer">
        <include refid="sql_count"></include>
        <include refid="sql_where"></include>
    </select>
</mapper>